# encoding: utf-8

require 'druzy/mvc'
require 'java'

module Competence

  class AboutView < Druzy::MVC::View

    java_import java.awt.event.WindowAdapter
    java_import javafx.application.Platform
    java_import javafx.embed.swing.JFXPanel
    java_import javafx.fxml.FXMLLoader
    java_import javafx.scene.Image
    java_import javafx.scene.Scene
    java_import javax.swing.JFrame
    java_import javax.swing.SwingUtilities

    def initialize(controller)
      super(controller)

      @url_fxml = 'file:'+File.dirname(__FILE__)+'/about_view.fxml'

      SwingUtilities.invoke_and_wait do
        @frame = JFrame.new('Ã€ propos')
        @frame.set_size(600,400)
        @frame.add_window_listener(Class.new(WindowAdapter) do
          def initialize(view)
            super()
            @view = view
          end

          def windowClosing(event)
            Thread.new do
              @view.controller.notify_action(@view,:cross_clicked)
            end
          end
        end.new(self))
      end

      @panel = JFXPanel.new

      current = Thread.current
      Platform.run_later do
        root = FXMLLoader.load(URL.new(@url_fxml))

        scene = Scene.new(root)

        @image = scene.lookup('#image')


        @exit_button = scene.lookup('#exit_button')
        @exit_button.set_on_action do
          Thread.new do
            @controller.notify_action(self,:exit_button_clicked)
          end
        end

        @panel.scene = scene
        current.wakeup
      end
      sleep

      @frame.add(@panel)
    end

    def display
      SwingUtilities.invoke_later do
        @frame.visible = true
      end
    end

    def close
      SwingUtilities.invoke_later do
        @frame.dispose
      end
    end

  end
end
